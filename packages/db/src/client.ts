import { getDb, getDbUrl } from "./utils/functions";

// Ensure configuration is present; getDbUrl throws for missing Postgres URLs.
getDbUrl();

export type AppDb = ReturnType<typeof getDb>;

declare global {
  // eslint-disable-next-line no-var
  var db: AppDb | null;
}

let db: AppDb;

if (env.NODE_ENV === "production") {
  db = getDb();
} else {
  if (!global.db) global.db = getDb();
  db = global.db;
}

export { db };
